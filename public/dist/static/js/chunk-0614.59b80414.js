(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0614"],{"/yXQ":function(t,e,s){"use strict";var i=s("gDS+"),a=s.n(i),r={name:"UpLoad",props:{index:{required:!0,type:Number},type:{required:!0,type:Number},filelists:{required:!1,type:Array,default:function(){return[]}},singlePic:{required:!1,type:String,default:null},ossparas:{required:!0,type:Object}},data:function(){return{btnText:"点击上传",dialogImageUrl:"",alignSelf:{margin:"83px 0 0 30px"},dialogVisible:!1,fileStorage:[],ossKey:{},mediaDuration:-1,resLoaded:!1,showV:!1,vsource:"",imageUrl:"",fileType:["audio/mp3","video/mp4","image/jpeg,image/png","image/jpeg,image/png"]}},computed:{},updated:function(){if(this.resLoaded){this.resLoaded=!1;var t=document.getElementById("video-active"+this.index),e=this;t.onloadedmetadata=function(){e.$emit("uploadSucess",{mediaDuration:t.duration,index:e.index,type:e.type,res_url:null})}}},mounted:function(){this.ossKey=JSON.parse(a()(this.ossparas)),3===this.type&&null!=this.singlePic&&(this.imageUrl=this.singlePic,this.btnText="替换"),1!==this.type&&0!==this.type||null===this.singlePic||(this.vsource=this.singlePic,this.showV=!0,this.resLoaded=!0,this.btnText="替换")},methods:{handleRemove:function(t,e){var s=this,i=[];e.forEach(function(t,e,a){i.push(s.ossparas.key+"data"+t.uid+"."+t.name.split(".")[t.name.split(".").length-1])}),this.$emit("uploadSucess",{mediaDuration:this.mediaDuration,index:this.index,type:this.type,res_url:i})},handleAvatarSuccess:function(t,e,s){var i=this;if(console.log(e,s),this.$refs.upload.submit(),this.fileStorage=s,2!==this.type){this.btnText="替换",this.fileStorage=[e];var a=this.ossparas.key+"data"+e.uid+"."+e.name.split(".")[e.name.split(".").length-1];this.$emit("uploadSucess",{mediaDuration:this.mediaDuration,index:this.index,type:this.type,res_url:a})}if(3===this.type&&(this.imageUrl=this.ossparas.host+"/"+this.ossparas.key+"data"+e.uid+"."+e.name.split(".")[e.name.split(".").length-1]),2!==this.type&&3!==this.type&&(this.showV=!0,this.resLoaded=!0),2===this.type){var r=!0,o=[];s.forEach(function(t,e,s){"success"===t.status?o.push(i.ossparas.key+"data"+t.uid+"."+t.name.split(".")[t.name.split(".").length-1]):(r=!1,o=[])}),r&&this.$emit("uploadSucess",{mediaDuration:this.mediaDuration,index:this.index,type:this.type,res_url:o})}},beforeAvatarUpload:function(t){2!==this.type&&(this.showV=!1);var e=this.ossparas.key+"data"+t.uid+"."+t.name.split(".")[t.name.split(".").length-1];this.ossKey.key=e,this.vsource=this.ossparas.host+"/"+this.ossKey.key},handlePictureCardPreview:function(t){this.dialogImageUrl=1===t?this.imageUrl:t.url,this.dialogVisible=!0}}},o=(s("OXd6"),s("Z36Z"),s("KHd+")),l=Object(o.a)(r,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"dndList"},[t.imageUrl?s("img",{staticClass:"avatar",staticStyle:{float:"left"},attrs:{src:t.imageUrl},on:{click:function(e){t.handlePictureCardPreview(1)}}}):t._e(),t._v(" "),t.showV?s("video",{staticClass:"video-active",attrs:{id:"video-active"+t.index,width:"320",height:"200",controls:"controls"}},[s("source",{attrs:{src:t.vsource,type:"video/mp4"}})]):t._e(),t._v(" "),s("el-upload",{ref:"upload",staticClass:"avatar-uploader",attrs:{"show-file-list":2==t.type,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload,"on-remove":t.handleRemove,"on-preview":t.handlePictureCardPreview,data:t.ossKey,multiple:2==t.type,accept:t.fileType[t.type],action:t.ossparas.host,"file-list":t.filelists,"list-type":2==t.type?"picture-card":""}},[2==t.type?s("i",{staticClass:"el-icon-plus"}):t._e(),t._v(" "),2!==t.type?s("el-button",{style:3!=t.type||null==t.singlePic&&!t.imageUrl?"":t.alignSelf,attrs:{size:"small",type:"success"},domProps:{textContent:t._s(t.btnText)}}):t._e()],1),t._v(" "),s("el-dialog",{attrs:{visible:t.dialogVisible},on:{"update:visible":function(e){t.dialogVisible=e}}},[s("img",{attrs:{src:t.dialogImageUrl,width:"100%",alt:""}})])],1)},[],!1,null,"0a979296",null);l.options.__file="index.vue";e.a=l.exports},Ms9V:function(t,e,s){},OXd6:function(t,e,s){"use strict";var i=s("uDfm");s.n(i).a},S8kR:function(t,e,s){"use strict";s.r(e);var i=s("gDS+"),a=s.n(i),r=s("/yXQ"),o=s("UMyc"),l={name:"BookEdit",components:{UpLoad:r.a},data:function(){return{path:"book",formMark:!0,ossParams:"",bookkinds:[],bEdit:!1,ulParamsMark:"",listLoading:!1,cdn:"https://cdncollege.quansuwangluo.com/",form:{buy:[{img_url:null,title:"",index:0}],score:"",catid:1,contents:"",title:"",author:"",status:1,pic:null},formRules:{title:[{required:!0,message:"请输入奖项名称",trigger:"blur"}],author:[{required:!0,message:"请输入作者名称",trigger:"blur"}],score:[{required:!0,message:"请输入评分",trigger:"blur"}],contents:[{required:!0,message:"请输入推荐理由",trigger:"blur"}],pic:[{required:!0,message:"请上传课程封面",trigger:"blur"}],catid:[{required:!0,message:"请选择奖项类型",trigger:"blur"}]}}},mounted:function(){var t=this;this.bEdit="0"!==this.$route.params.id,this.bEdit&&this.getInfos(this.$route.params.id),this.listLoading=!0,Object(o.j)({type:"dev_test_dcaredata"}).then(function(e){t.ossParams=e.data.datas,t.ulParamsMark=!0,t.listLoading=!1}),this.getBookKind()},methods:{getBookKind:function(){var t=this;this.listLoading=!0,Object(o.i)("category",{page:1,limit:99999,type:1}).then(function(e){t.bookkinds=e.data.datas,t.listLoading=!1})},delAd:function(t){this.form.buy.splice(t,1)},addOptions:function(){var t={img_url:null,title:"",index:this.form.buy.length+1};this.form.buy.push(t)},uploadSucess:function(t){-1===t.index?this.form.pic=t.res_url:this.form.buy[t.index].img_url=t.res_url},getInfos:function(t){var e=this;this.listLoading=!0,this.formMark=!1,Object(o.g)(this.path,{id:t}).then(function(t){e.form=t.data.datas,console.log(t),e.formMark=!0,e.listLoading=!1})},onSubmit:function(){var t=this;isNaN(parseFloat(this.form.score))?this.$message("奖项评分处请输入合法数字格式"):parseFloat(this.form.score)>10?this.$message("奖项评分不能超过10"):(this.form.score=parseFloat(this.form.score),this.$refs.form.validate(function(e){if(!e)return console.log("error submit!!"),!1;t.listLoading=!0,Object(o.a)(t.path,t.form).then(function(e){t.$message(e.data.info),t.listLoading=!1,t.$store.dispatch("delView",t.$route),t.$router.replace("/books/index"),sessionStorage.setItem("refresh",a()(1))})}))},onCancel:function(){this.$message({message:"cancel!",type:"warning"})}}},n=(s("pdUJ"),s("KHd+")),u=Object(n.a)(l,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("el-form",{ref:"form",attrs:{model:t.form,rules:t.formRules,"label-width":"260px"}},[s("el-form-item",{attrs:{label:"奖项名称:",prop:"title"}},[s("el-input",{model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"奖项作者:",prop:"title"}},[s("el-input",{model:{value:t.form.author,callback:function(e){t.$set(t.form,"author",e)},expression:"form.author"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"奖项评分:",prop:"title"}},[s("el-input",{attrs:{placeholder:"请输入0-10之间的数字"},model:{value:t.form.score,callback:function(e){t.$set(t.form,"score",e)},expression:"form.score"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"奖项封面(推荐尺寸:97 x 130)",prop:"pic"}},[t.ulParamsMark&&t.formMark?s("up-load",{attrs:{index:-1,type:3,"single-pic":t.bEdit?t.cdn+t.form.pic:t.form.pic,ossparas:t.ossParams},on:{uploadSucess:t.uploadSucess}}):t._e()],1),t._v(" "),s("el-form-item",{attrs:{label:"奖项分类:",prop:"catid"}},[s("el-select",{staticClass:"filter-item",staticStyle:{width:"140px"},model:{value:t.form.catid,callback:function(e){t.$set(t.form,"catid",e)},expression:"form.catid"}},t._l(t.bookkinds,function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),s("el-form-item",{attrs:{rules:{required:!0,message:"推荐理由不能为空",trigger:"blur"},label:"推荐理由",prop:"contents"}},[s("el-input",{attrs:{type:"textarea"},model:{value:t.form.contents,callback:function(e){t.$set(t.form,"contents",e)},expression:"form.contents"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"是否上架:",prop:"status"}},[s("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[s("el-radio",{attrs:{label:1}},[t._v("显示")]),t._v(" "),s("el-radio",{attrs:{label:0}},[t._v("不显示")])],1)],1),t._v(" "),t._l(t.form.buy,function(e,i){return s("el-form-item",{key:i,attrs:{label:"购买渠道"+(i+1)}},[s("div",{staticClass:"divContent"},[s("div",{staticClass:"delete",on:{click:function(e){t.delAd(i)}}},[t._v("+")]),t._v(" "),s("div",{staticClass:"title"},[t._v("上传logo(推荐尺寸：50 x 18)")]),t._v(" "),s("div",[t.ulParamsMark&&t.formMark?s("up-load",{attrs:{index:i,type:3,"single-pic":t.bEdit?t.cdn+e.img_url:e.img_url,ossparas:t.ossParams},on:{uploadSucess:t.uploadSucess}}):t._e()],1),t._v(" "),s("div",{staticClass:"title"},[t._v("渠道名称：")]),t._v(" "),s("el-input",{model:{value:e.title,callback:function(s){t.$set(e,"title",s)},expression:"item.title"}})],1)])})],2),t._v(" "),s("el-form",{ref:"form3",staticStyle:{"margin-top":"30px"},attrs:{"label-width":"260px"}},[t.form.buy.length<2?s("el-form-item",[s("el-button",{attrs:{type:"success"},on:{click:t.addOptions}},[t._v("添加购买渠道")])],1):t._e(),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("保存")])],1)],1)],1)},[],!1,null,"151200ab",null);u.options.__file="options.vue";e.default=u.exports},Z36Z:function(t,e,s){"use strict";var i=s("Ms9V");s.n(i).a},eNxN:function(t,e,s){},pdUJ:function(t,e,s){"use strict";var i=s("eNxN");s.n(i).a},uDfm:function(t,e,s){}}]);