(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-c865"],{"7cR4":function(t,e,s){"use strict";s.r(e);var i=s("gDS+"),o=s.n(i),a=s("glbJ"),r=s("xKIC"),l=s("/yXQ"),n=s("Muo0"),c=s("UMyc"),m={name:"CourseEdit",components:{DndList:r.a,UpLoad:l.a,QuesSel:n.a,Tinymce:a.a},data:function(){return{formMark:!1,showQuesSel:!1,qstListObj:[],qstListAbj:[],qstListBind:[],abjTitle:"",qsIndex:-1,qst_id:"",path:"course",ossParams:{},ulParamsMark:!1,listLoading:!1,listQuery:"",cdn:"https://cdncollege.quansuwangluo.com/",teacherList:[],schoolList:[{title:"基础课程",id:1},{title:"进阶课程",id:2},{title:"高阶课程",id:3}],courseKind:[{label:"公开课",key:1},{label:"单课",key:2}],sectionKindList:[{label:"音频mp3",key:0},{label:"视频mp4",key:1}],bEdit:!1,form:{sections:[{id:0,title:"",contents:"",imgs:[],media:"",time:"",qstTitle:"",question_id:-1}],title:"",teacher_id:1,list_order:0,tab:"",id:0,pic:null,poster:null,catid:1,start_time:"",question_id:-1,is_video:1,status:0,desc:""},formRules:{title:[{required:!0,message:"请输入课程名称",trigger:"blur"}],tab:[{required:!0,message:"请输入标识",trigger:"blur"}],start_time:[{required:!0,message:"请选择上架时间",trigger:"blur"}],price:[{required:!0,message:"请输入价格",trigger:"blur"}]}}},mounted:function(){var t=this;this.bEdit="0"!==this.$route.params.id,this.getInfos(this.$route.params.id),this.listLoading=!0,this.getQuestionsList([1,2]),this.getQuestionsList([3]),Object(c.j)({type:"dev_test_dcaredata"}).then(function(e){t.ossParams=e.data.datas,t.ulParamsMark=!0,t.listLoading=!1})},methods:{getInfos:function(t){var e=this;this.listLoading=!0,this.formMark=!1,Object(c.g)(this.path,{id:t}).then(function(t){e.formMark=!0,e.bEdit&&(e.form=t.data.datas.course,e.abjTitle=e.form.qstTitle,e.form.sections.forEach(function(t,s,i){t.mediatemp=null===t.media?null:e.cdn+t.media,t.imgstemp=e.formatImg(t.imgs)})),e.teacherList=t.data.datas.teacher,e.schoolList=t.data.datas.category,e.listLoading=!1})},formatImg:function(t){var e=this,s=[];return t.forEach(function(t,i,o){var a={uid:"",url:"",name:""};a.name=t.substring(t.length-6),a.url=e.cdn+t,a.uid=t.replace(/[^0-9]/gi,""),s.push(a)}),s},showQstList:function(t){this.qstListBind=-1===t?this.qstListAbj:this.qstListObj,this.qst_id=-1===t?this.form.question_id:this.form.sections[t].question,this.qsIndex=t,this.showQuesSel=!0},closeQL:function(){this.showQuesSel=!1},choose:function(t){this.showQuesSel=!1,-1===t.index?(this.abjTitle=t.chooseItem.title||"",this.form.question_id=t.chooseItem.id):(this.form.sections[t.index].qstTitle=t.chooseItem.title||"",this.form.sections[t.index].question_id=t.chooseItem.id)},getQuestionsList:function(t){var e=this;this.listLoading=!0,Object(c.i)("question",{page:1,limit:99999,type:t}).then(function(s){1===t.length?e.qstListAbj=s.data.datas:e.qstListObj=s.data.datas,e.listLoading=!1})},uploadSucess:function(t){null!==t.res_url&&(2===t.type&&(this.form.sections[t.index].imgs=t.res_url),0!==t.type&&1!==t.type||(this.form.sections[t.index].media=t.res_url),3===t.type&&(-1===t.index&&(this.form.pic=t.res_url),-2===t.index&&(this.form.poster=t.res_url))),-1!==t.mediaDuration&&(this.form.sections[t.index].time=t.mediaDuration)},deleteClass:function(t){this.form.sections.splice(t,1)},removeDomain:function(t){var e=this.form.queoptions.indexOf(t);-1!==e&&this.form.queoptions.splice(e,1)},addOptions:function(){console.log(this.ossParams),this.form.sections.push({id:0,title:"",imgs:[],media:"",mediatemp:null,imgstemp:[],time:"",qstTitle:"",question_id:-1,question:""})},handleFilter:function(t){0===this.form.kind&&(this.form.rightAns=0),1===this.form.kind&&(this.form.rightAns=[0,1])},addCourse:function(){var t=this;this.listLoading=!0,Object(c.a)(this.path,this.form).then(function(e){t.listLoading=!1,t.$message(e.data.message),t.$store.dispatch("delView",t.$route),t.$router.replace("/college/course"),sessionStorage.setItem("refresh",o()(1))})},onSubmit:function(t){var e=this;console.log(this.form),this.$refs.form.validate(function(s){if(!s)return!1;var i=!1;e.form.sections.forEach(function(t,s,o){if(!t.time||!t.media)return e.$message({message:"第"+(s+1)+"章未传音频、视频",type:"error"}),void(i=!0)}),i||(e.form.id=2===t?0:e.form.id,e.addCourse())}),this.$message("submit!")},onCancel:function(){this.$message({message:"cancel!",type:"warning"})}}},d=(s("ZWbF"),s("KHd+")),u=Object(d.a)(m,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[t.formMark?s("el-form",{ref:"form",attrs:{model:t.form,rules:t.formRules,"label-width":"260px"}},[s("el-form-item",{attrs:{label:"课程名称",prop:"title"}},[s("el-input",{model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"课程标识",prop:"tab"}},[s("el-input",{model:{value:t.form.tab,callback:function(e){t.$set(t.form,"tab",e)},expression:"form.tab"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"课程序列号"}},[s("el-input",{model:{value:t.form.list_order,callback:function(e){t.$set(t.form,"list_order",e)},expression:"form.list_order"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"归属分类",prop:"catid"}},[s("el-select",{staticClass:"filter-item",staticStyle:{width:"140px"},on:{change:function(e){t.handleFilter(1)}},model:{value:t.form.catid,callback:function(e){t.$set(t.form,"catid",e)},expression:"form.catid"}},t._l(t.schoolList,function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),s("el-form-item",{attrs:{label:"课程封面(推荐尺寸:474 x 354)",prop:"ppt"}},[t.ulParamsMark&&t.formMark?s("up-load",{attrs:{"single-pic":t.bEdit?t.cdn+t.form.pic:t.form.pic,index:-1,type:3,ossparas:t.ossParams},on:{uploadSucess:t.uploadSucess}}):t._e()],1),t._v(" "),s("el-form-item",{attrs:{label:"播放背景图(推荐尺寸:750 x 422 )",prop:"poster"}},[t.ulParamsMark&&t.formMark?s("up-load",{attrs:{"single-pic":t.bEdit?t.cdn+t.form.poster:t.form.poster,index:-2,type:3,ossparas:t.ossParams},on:{uploadSucess:t.uploadSucess}}):t._e()],1),t._v(" "),s("el-form-item",{attrs:{label:"讲师",prop:"teacher_id"}},[s("el-select",{staticClass:"filter-item",staticStyle:{width:"140px"},on:{change:function(e){t.handleFilter(0)}},model:{value:t.form.teacher_id,callback:function(e){t.$set(t.form,"teacher_id",e)},expression:"form.teacher_id"}},t._l(t.teacherList,function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.id}})}))],1),t._v(" "),s("el-form-item",{attrs:{label:"课程类型",prop:"is_video"}},[s("el-select",{staticClass:"filter-item",staticStyle:{width:"140px"},attrs:{disabled:t.bEdit},on:{change:function(e){t.handleFilter(0)}},model:{value:t.form.is_video,callback:function(e){t.$set(t.form,"is_video",e)},expression:"form.is_video"}},t._l(t.sectionKindList,function(t){return s("el-option",{key:t.key,attrs:{label:t.label,value:t.key}})}))],1),t._v(" "),s("el-form-item",{attrs:{label:"是否发布"}},[s("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[s("el-radio",{attrs:{label:1}},[t._v("是")]),t._v(" "),s("el-radio",{attrs:{label:0}},[t._v("否")])],1)],1),t._v(" "),s("el-form-item",{attrs:{label:"上架时间",prop:"start_time"}},[s("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.form.start_time,callback:function(e){t.$set(t.form,"start_time",e)},expression:"form.start_time"}})],1),t._v(" "),s("el-form-item",{attrs:{rules:{required:!0,message:"课程简介不能为空",trigger:"blur"},label:"课程简介",prop:"desc"}},[s("el-input",{attrs:{type:"textarea"},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"添加简答题",prop:"question"}},[""!==t.abjTitle?s("span",{staticClass:"testText"},[t._v(t._s(t.form.question_id)+"、"+t._s(t.abjTitle))]):t._e(),t._v(" "),s("el-button",{attrs:{type:"success"},on:{click:function(e){t.showQstList(-1)}}},[t._v(t._s(""==t.abjTitle?"选择":"修改"))])],1)],1):t._e(),t._v(" "),s("div",{staticClass:"sections"},[t._v("章节内容")]),t._v(" "),t.formMark?s("el-form",{ref:"form2",attrs:{"label-width":"260px"}},t._l(t.form.sections,function(e,i){return s("div",{key:i,staticClass:"containers"},[s("div",{staticClass:"deleteClass",on:{click:function(e){t.deleteClass(i)}}},[t._v("删除章节")]),t._v(" "),s("legend",{domProps:{textContent:t._s(""==e.title?"章节名称":i+1+"、"+e.title)}}),t._v(" "),s("el-form-item",{attrs:{label:"章节名称"}},[s("el-input",{model:{value:e.title,callback:function(s){t.$set(e,"title",s)},expression:"list.title"}})],1),t._v(" "),s("el-form-item",{attrs:{label:0==t.form.is_video?"添加音频*.mp3":"添加视频*.mp4"}},[t.ulParamsMark&&t.formMark?s("up-load",{attrs:{"single-pic":e.mediatemp,index:i,type:t.form.is_video,ossparas:t.ossParams},on:{uploadSucess:t.uploadSucess}}):t._e()],1),t._v(" "),s("el-form-item",{attrs:{label:"课程时长"}},[s("el-input",{model:{value:e.time,callback:function(s){t.$set(e,"time",s)},expression:"list.time"}})],1),t._v(" "),s("el-form-item",{attrs:{label:"添加测题",prop:"question_id"}},[""!==e.qstTitle?s("span",{staticClass:"testText"},[t._v(t._s(e.question_id)+"、"+t._s(e.qstTitle))]):t._e(),t._v(" "),s("el-button",{attrs:{type:"success"},on:{click:function(e){t.showQstList(i)}}},[t._v(t._s(""==e.qstTitle?"选择":"修改"))])],1),t._v(" "),s("el-form-item",{attrs:{label:"课程精华:",prop:"contents"}},[s("div",[s("tinymce",{attrs:{height:300},model:{value:e.contents,callback:function(s){t.$set(e,"contents",s)},expression:"list.contents"}})],1)])],1)})):t._e(),t._v(" "),s("el-form",{ref:"form3",staticStyle:{"margin-top":"30px"},attrs:{"label-width":"260px"}},[s("el-form-item",[s("el-button",{attrs:{type:"success"},on:{click:t.addOptions}},[t._v("添加章节")])],1),t._v(" "),s("el-form-item",[s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.onSubmit(1)}}},[t._v("保存")]),t._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(e){t.onSubmit(2)}}},[t._v("保存为新课程")])],1)],1),t._v(" "),t.showQuesSel?s("div",{staticClass:"showQL"},[s("div",{staticClass:"back",on:{click:t.closeQL}}),t._v(" "),s("div",{staticClass:"content"},[s("ques-sel",{attrs:{"qst-list":t.qstListBind,qst_id:t.qst_id,index:t.qsIndex},on:{choose:t.choose}})],1)]):t._e()],1)},[],!1,null,"38e6fa24",null);u.options.__file="options.vue";e.default=u.exports},ZWbF:function(t,e,s){"use strict";var i=s("m3eY");s.n(i).a},m3eY:function(t,e,s){}}]);